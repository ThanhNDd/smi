<script>
  let json = {"status":200,"error":false,"message":"OK","data":{"pageIndex":1,"pageSize":10,"totalPage":14,"totalElements":138,"data":[{"RN":1,"CUS_ID":6726766,"ORDER_NUMBER":"1623209720192","ORDER_REFERENCE":"1623209720192","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-18T10:24:41","RECEIVER_FULLNAME":"Chip Jelly","RECEIVER_ADDRESS":"Thôn phú lợi, XÃ KỲ PHÚ, HUYỆN KỲ ANH, Hà Tĩnh","RECEIVER_PHONE":"0367381432","PRODUCT_NAME":"1xÁo Phao Trẻ Em","MONEY_COLLECTION":350000,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"28001","ORDER_TYPE":1,"ORDER_SERVICE":"LCOD","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"},{"RN":2,"CUS_ID":6726766,"ORDER_NUMBER":"1618175525587","ORDER_REFERENCE":"1618175525587","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-16T09:03:40","RECEIVER_FULLNAME":"Hoa Lê","RECEIVER_ADDRESS":"kim bồng, XÃ KIM ĐƯỜNG, HUYỆN ỨNG HÒA, Hà Nội","RECEIVER_PHONE":"0972759641","PRODUCT_NAME":"1xGiày đen size 25","MONEY_COLLECTION":250000,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"16500","ORDER_TYPE":1,"ORDER_SERVICE":"PHS","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"},{"RN":3,"CUS_ID":6726766,"ORDER_NUMBER":"1618208477475","ORDER_REFERENCE":"1618208477475","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-16T09:04:13","RECEIVER_FULLNAME":"Lưu thị Lượng","RECEIVER_ADDRESS":"Sn 11 Lô B33 Tổ 52H Khu 4A, PHƯỜNG CAO XANH, THÀNH PHỐ HẠ LONG, Quảng Ninh","RECEIVER_PHONE":"0974287043","PRODUCT_NAME":"1xGiày đen 34","MONEY_COLLECTION":0,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"12144","ORDER_TYPE":1,"ORDER_SERVICE":"VTK","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"},{"RN":4,"CUS_ID":6726766,"ORDER_NUMBER":"1638130211867","ORDER_REFERENCE":"1638130211867","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-15T14:37:41","RECEIVER_FULLNAME":"Lương thị Thúy Hiên","RECEIVER_ADDRESS":"Tổ 3 Ấp suối mây, XÃ DƯƠNG TƠ, HUYỆN PHÚ QUỐC, Kiên Giang","RECEIVER_PHONE":"0776884088","PRODUCT_NAME":"1xGiày đỏ size 32","MONEY_COLLECTION":265000,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"45500","ORDER_TYPE":1,"ORDER_SERVICE":"NCOD","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"},{"RN":5,"CUS_ID":6726766,"ORDER_NUMBER":"1637544391608","ORDER_REFERENCE":"1637544391608","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-15T14:27:55","RECEIVER_FULLNAME":"Gia Bao","RECEIVER_ADDRESS":"122/23a miếu gò xoài, PHƯỜNG BÌNH HƯNG HÒA A, QUẬN BÌNH TÂN, Hồ Chí Minh","RECEIVER_PHONE":"0353628307","PRODUCT_NAME":"1xGiày đen size 33","MONEY_COLLECTION":0,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"12144","ORDER_TYPE":1,"ORDER_SERVICE":"VTK","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"},{"RN":6,"CUS_ID":6726766,"ORDER_NUMBER":"1637304001765","ORDER_REFERENCE":"1637304001765","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-15T14:23:55","RECEIVER_FULLNAME":"Kha Ly","RECEIVER_ADDRESS":"44 ấp cảng, XÃ HÒA ĐIỀN, HUYỆN KIÊN LƯƠNG, Kiên Giang","RECEIVER_PHONE":"0359639362","PRODUCT_NAME":"1xGiày trắng size 20","MONEY_COLLECTION":260000,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"35000","ORDER_TYPE":1,"ORDER_SERVICE":"LCOD","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"},{"RN":7,"CUS_ID":6726766,"ORDER_NUMBER":"1637247772318","ORDER_REFERENCE":"1637247772318","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-15T14:22:58","RECEIVER_FULLNAME":"Thuyen Hoa","RECEIVER_ADDRESS":"tóc thanh thuyền thôn 4a, XÃ EA HIAO, HUYỆN EA H'LEO, Đăk Lăk\r\n","RECEIVER_PHONE":"0975596576","PRODUCT_NAME":"1xGiày đen 35 và tất","MONEY_COLLECTION":380000,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"35000","ORDER_TYPE":1,"ORDER_SERVICE":"LCOD","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"},{"RN":8,"CUS_ID":6726766,"ORDER_NUMBER":"1634249922924","ORDER_REFERENCE":"1634249922924","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-15T13:33:01","RECEIVER_FULLNAME":"Cao Yến","RECEIVER_ADDRESS":"Buôn briêng b, XÃ EA NAM, HUYỆN EA H'LEO, Đăk Lăk\r\n","RECEIVER_PHONE":"0977708244","PRODUCT_NAME":"1xGiày Vải Trẻ Em Trắng size 22","MONEY_COLLECTION":260000,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"35000","ORDER_TYPE":1,"ORDER_SERVICE":"LCOD","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"},{"RN":9,"CUS_ID":6726766,"ORDER_NUMBER":"1634424055394","ORDER_REFERENCE":"1634424055394","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-13T13:38:48","RECEIVER_FULLNAME":"Châu Hoa","RECEIVER_ADDRESS":"35 nguyên chi thanh, THỊ TRẤN ĐĂK MIL, HUYỆN ĐẮK MIL, Đăk Nông","RECEIVER_PHONE":"0356275899","PRODUCT_NAME":"1xGiày đen 34","MONEY_COLLECTION":260000,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"35000","ORDER_TYPE":1,"ORDER_SERVICE":"LCOD","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"},{"RN":10,"CUS_ID":6726766,"ORDER_NUMBER":"1634379417339","ORDER_REFERENCE":"1634379417339","ORDER_STATUS":501,"ORDER_SYSTEMDATE":"2021-01-13T13:38:03","RECEIVER_FULLNAME":"Nhung Mai","RECEIVER_ADDRESS":"Ấp 6, XÃ BOM BO, HUYỆN BÙ ĐĂNG, Bình Phước","RECEIVER_PHONE":"0973424214","PRODUCT_NAME":"1xGiày đen 34","MONEY_COLLECTION":260000,"TOTAL":138,"ORDER_ACTION_505":0,"SENDER_FULLNAME":"chu thị quyên","COLOR_STATUS":"5CB85C","MONEY_TOTAL":"35000","ORDER_TYPE":1,"ORDER_SERVICE":"LCOD","IS_RETURN":0,"IS_RESEND":0,"EDIT_INFO":false,"IS_EDIT":0,"ORDER_NOTE":"Cho khách xem hàng"}]}};
  $(document).ready(function () {
      let bills = [];
      let count = 0;
      $.each(json.data.data, function (k, v) {
          console.log(v.ORDER_NUMBER);
          bills.push(v.ORDER_NUMBER);
          if(count === json.data.data.length - 1) {
              console.log(count);
              update_status_by_bill(bills);
          }
          count++;
      });


  });

  function update_status_by_bill(bills) {
      $.ajax({
          url: '<?php Common::getPath() ?>src/controller/orders/OrderController.php',
          type: 'POST',
          data: {
              method: "update_status_by_bills",
              bills: JSON.stringify(bills)
          },
          dataType: "json",
          success: function (res) {
              console.log(res);
          },
          error: function (data, errorThrown) {
              console.log(data.responseText);
              console.log(errorThrown);
              Swal.fire({
                  type: 'error',
                  title: 'Đã xảy ra lỗi',
                  text: "Vui lòng liên hệ quản trị hệ thống để khắc phục"
              });
          }
      })
  }



</script>
